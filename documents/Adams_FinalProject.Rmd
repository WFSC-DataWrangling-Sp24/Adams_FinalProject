---
title: "Adams_FinalProject"
author: "Grace Adams"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/graceadams/Documents/Git/Adams_FinalProject')
```

## Final Project

# Problem Decomposition

    -   At the beginning of the document to introduce your dataset and the general tasks that you will be completing in the following code chunks (problem decomposition).
    -   Text between the code chunks outlining the tasks that each code chunk is performing.
    
    
    - Weeks to include 
      - 2 - Wirtten in R (DONE)
      - 5 - Data viz (DONE)
      - 8 - Accomplish a larger task
      - 9 - GitHub Repo/Reproducibility (DONE)
      - 11 - Making Choices 
      
      - 6 - Tidy Data ? (renaming columns,,,, can rename a few and call it good?)

A handful of fyi stuff: 

- cbb.csv has seasons 2013-2019 and seasons 2021-2023 combined

- The 2020 season's data set is kept separate from the other seasons, because there was no postseason due to the Coronavirus.

- cbb24 contains data as of 3/18/2024. This dataset will be updated and added to cbb.csv at the conclusion of the Tournament.

Data Dictionary: 

- RK (Only in cbb20): The ranking of the team at the end of the regular season according to barttorvik

- TEAM: The Division I college basketball school

- CONF: The Athletic Conference in which the school participates in 
    - (A10 = Atlantic 10, 
    - ACC = Atlantic Coast Conference, 
    - AE = America East, 
    - Amer = American, 
    - ASun = ASUN, 
    - B10 = Big Ten, 
    - B12 = Big 12, 
    - BE = Big East, 
    - BSky = Big Sky, 
    - BSth = Big South, 
    - BW = Big West, 
    - CAA = Colonial Athletic Association, 
    - CUSA = Conference USA, 
    - Horz = Horizon League, 
    - Ivy = Ivy League, 
    - MAAC = Metro Atlantic Athletic Conference, 
    - MAC = Mid-American Conference, 
    - MEAC = Mid-Eastern Athletic Conference, 
    - MVC = Missouri Valley Conference, 
    - MWC = Mountain West, 
    - NEC = Northeast Conference, 
    - OVC = Ohio Valley Conference, 
    - P12 = Pac-12, 
    - Pat = Patriot League, 
    - SB = Sun Belt, 
    - SC = Southern Conference, 
    - SEC = South Eastern Conference, 
    - Slnd = Southland Conference, 
    - Sum = Summit League, 
    - SWAC = Southwestern Athletic Conference, 
    - WAC = Western Athletic Conference, 
    - WCC = West Coast Conference)

- G: Number of games played

- W: Number of games won

- ADJOE: Adjusted Offensive Efficiency (An estimate of the offensive efficiency (points scored per 100 possessions) a team would have against the average Division I defense)

- ADJDE: Adjusted Defensive Efficiency (An estimate of the defensive efficiency (points allowed per 100 possessions) a team would have against the average Division I offense)

- BARTHAG: Power Rating (Chance of beating an average Division I team)

- EFG_O: Effective Field Goal Percentage Shot

- EFG_D: Effective Field Goal Percentage Allowed

- TOR: Turnover Percentage Allowed (Turnover Rate)

- TORD: Turnover Percentage Committed (Steal Rate)

- ORB: Offensive Rebound Rate

- DRB: Offensive Rebound Rate Allowed

- FTR : Free Throw Rate (How often the given team shoots Free Throws)

- FTRD: Free Throw Rate Allowed

- 2P_O: Two-Point Shooting Percentage

- 2P_D: Two-Point Shooting Percentage Allowed

- 3P_O: Three-Point Shooting Percentage

- 3P_D: Three-Point Shooting Percentage Allowed

- ADJ_T: Adjusted Tempo (An estimate of the tempo (possessions per 40 minutes) a team would have against the team that wants to play at an average Division I tempo)

- WAB: Wins Above Bubble (The bubble refers to the cut off between making the NCAA March Madness Tournament and not making it)

- POSTSEASON: Round where the given team was eliminated or where their season ended (R68 = First Four, R64 = Round of 64, R32 = Round of 32, S16 = Sweet Sixteen, E8 = Elite Eight, F4 = Final Four, 2ND = Runner-up, Champion = Winner of the NCAA March Madness Tournament for that given year)

- SEED: Seed in the NCAA March Madness Tournament

- YEAR: Season



## Loading packages

```{r}
#install.packages("tidyverse")
library(tidyverse)

#install.packages("ggplot2")
library(ggplot2)

#install.packages("ggpubr")
library(ggpubr)

#install.packages("RColorBrewer)
library(RColorBrewer)
```


## Reading in the data


# Set the directory where your .csv files are located
```{r}
getwd()


# create object to store directory of the files you want to use 
folder_path <- "./data_raw/cbb"
```

# List all .csv files in the folder
```{r}
file_list <- list.files (folder_path, pattern = "cbb[0-9]{2}\\.csv")
```


## Loop through each file and read it into the environment
## I don't think this was taught in class, need to find a way to do this with the things taught in class??
```{r}
for (file in file_list) {
  # Extract the two-digit number from the file name
  file_number <- gsub("cbb|\\.csv", "", file)
  
  # Read the .csv file into a data frame with a name based on the file number
  assign(paste0("cbb", file_number), read.csv(file.path(folder_path, file)))
}

# load in cbb.csv file on its own

cbb <- read_csv("./data_raw/cbb/cbb.csv")

```

## Okay let's try it using Week 12 stuff:
```{r}
#for (file in file_list) {
  # Extract the two-digit number from the file name
 # file_number <- gsub("cbb|\\.csv", "", file)
  
  # I need to do something here that will pull each .csv based on file_number and then assign each value of file_number to a new data frame named "cbb*file_number*" 
  
  
#}


# as of 05/03/24 need to come back to this
```


## Data Exploration
```{r}
summary(cbb)
glimpse(cbb)
```

What kind of stuff do I have here?

- 4 character variables (TEAM, CONF, POSTSEASON, SEED)

- 20 numeric variables (G, W, ADJOE, ADJDE, BARTHAG, EFG_O, EFG_D, TOR, TORD, ORB, DRB, FTR, FTRD, X2P_O, X2P_D, X3P_O, X3P_D, ADJ_T, WAB, YEAR)

  - Very happy that there does not appear to be any NAs in the numeric stuff or in the character stuff 

summary(cbb13)

- What kind of things can I glean from this data?

# Let's just jump right into it!


Some wee cleaning up (year, postseason, team, conference into factors)
```{r}
cbb$TEAM <- as.factor(cbb$TEAM)

cbb$SEED <- as.factor(cbb$SEED)
seed <- c("1" = "red", "2" = "orange", "3" = "yellow", "4"= "green", "5"= "blue", "6" = "mediumpurple", "7" = "purple", "8"= "firebrick", "9"= "darkorange", "10" = "gold2", "11" = "seagreen", "12" = "slateblue", "13" = "darkorchid", "14"= "magenta3","15" = "deeppink3", "16"= "mediumvioletred")

cbb$YEAR <- as.factor(cbb$YEAR)

cbb$POSTSEASON <- as.factor(cbb$POSTSEASON)
postseason = c('R68'='darkorchid3','R64'='firebrick3','R32'='aquamarine3','S16'='slateblue3','E8' = 'green3', 'F4' = 'goldenrod3', '2ND' = 'gray71', 'Champions' = 'gold2')


cbb$CONF <- as.factor(cbb$CONF)
```



```{r}
cbb %>% 
  filter(TEAM == "Arizona")
```

```{r}
arizona_seed <- cbb %>% 
  filter(TEAM == "Arizona", !is.na(SEED)) %>% 
  ggplot(aes(x=YEAR, y=SEED, fill=SEED))+
  scale_fill_manual(values=seed)+
  geom_col()+
  labs(x="Year", y="Seed", title = "Arizona's Seed in NCAA March Madness Tournament")+
  theme_classic()

uconn_seed <- cbb %>% 
  filter(TEAM == "Connecticut", !is.na(SEED)) %>% 
  ggplot(aes(x=YEAR, y=SEED, fill=SEED))+
  scale_fill_manual(values=seed)+
  geom_col()+
  labs(x="Year", y="Seed", title = "UConn's Seed in NCAA March Madness Tournament")+
  theme_classic()

seed_plot <- ggarrange(arizona_seed, uconn_seed, ncol = 1, nrow = 2)

seed_plot
  
```


```{r}
arizona_postseason <- cbb %>% 
  filter(TEAM == "Arizona", !is.na(POSTSEASON), !POSTSEASON == "N/A") %>% 
  ggplot(aes(x=YEAR, y=POSTSEASON, fill=POSTSEASON))+
  scale_fill_manual(values = postseason)+
  geom_col()+
  labs(x="Year", y="Post Season Exit Round", title = "Arizona's Post Season Exit Round in NCAA March Madness Tournament")+
  theme_classic()


uconn_postseason <- cbb %>% 
  filter(TEAM == "Connecticut", !is.na(POSTSEASON), !POSTSEASON == "N/A") %>% 
  ggplot(aes(x=YEAR, y=POSTSEASON, fill = POSTSEASON))+
  scale_fill_manual(values = postseason)+
  geom_col()+
  labs(x="Year", y="Post Season Exit Round", title = "UConn's Post Season Exit Round in NCAA March Madness Tournament")+
  theme_classic()

postseason_plot <- ggarrange(arizona_postseason, uconn_postseason, ncol=1, nrow=2)

postseason_plot
```


```{r}
arizona_drb <- cbb %>% 
  filter(TEAM == "Arizona", !is.na(DRB), !DRB == "N/A") %>% 
  ggplot(aes(x=YEAR, y=DRB, fill=DRB))+
  geom_col()+
  scale_fill_viridis_c(option = "magma")+
  labs(x="Year", y="Defensive Rebound Rate", title = "Arizona's Defensive Rebound Rate")+
  theme_classic()

uconn_drb <- cbb %>% 
  filter(TEAM == "Connecticut", !is.na(DRB), !DRB == "N/A") %>% 
  ggplot(aes(x=YEAR, y=DRB, fill=DRB))+
  geom_col()+
  scale_fill_viridis_c(option = "magma")+
  labs(x="Year", y="Defensive Rebound Rate", title = "UConn's Defensive Rebound Rate")+
  theme_classic()

drb_plot <- ggarrange(arizona_drb, uconn_drb, ncol=1, nrow=2)

drb_plot
```

Making a new column based on if the school is Division 1 or other divisions

```{r}
# make division groups for each year
division1 <- c("")
cbb %>% 
  mutate(DIV == case_when(CONF %in% division1~"1",
                          CONF %in% division2~"2",
                          CONF %in% division3~"3",
                          NA=TRUE))
```



Kinda want to see how many schools were in each conference for each year

```{r}
cbb %>% 
  ggplot(aes(x=CONF))+
  geom_bar()
```


## Things I may need to do

- I'm gonna want to make postseason, possibly seed, possibly conference, and possibly team into factors with levels for easier plotting. 

- 

## What I said I wanted to do in the proposal

- 3.  Speaking generally, what tasks will you perform with this dataset? It might include tasks that we have not yet covered how to accomplish in class, but come up with a general plan that you would like to follow.

  I'm interested to combine the .csv files into one large file with a year column and make a few plots showing how each team has done over the years. I am obviously most interested in Arizona basketball, but I'll make a few plots of when a handful of teams exited the postseason tournament (which I am currently traveling for) each year. 
  
4.  One of the requirements of the final project is to make some type of plot using `ggplot2` with the data. What do you plan to plot from your data?

  I plan to plot a histogram of the frequency of when Arizona basketball exited from the March Madness tournament over the years. I also plan to plot the champions over the past 11 years and perhaps their win-loss record as well. I might plot conference as well, noting any changes in conference over the years. 


